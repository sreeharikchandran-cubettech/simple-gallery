function debug(message){window.console&&console.log(message)}jQuery.browser={},jQuery.browser.msie=!1,jQuery.browser.version=0,navigator.userAgent.match(/MSIE ([0-9]+)\./)&&(jQuery.browser.msie=!0,jQuery.browser.version=RegExp.$1),jQuery.noConflict(),jQuery(document).ready((function($){var galleries=$("div.simplegallery"),numGalleries=galleries.size();for(i=0;i<numGalleries;i++)simplegallery($(galleries[i]).attr("id"));function simplegallery(id){var selector="#"+id,index=0,thumbs=$(selector+" .thumbnails dt a"),thumbnailcontainer=$(selector+" .thumbnails"),largeimagecontainer=$(selector+" .largeimage"),large=$(largeimagecontainer).children("a").children("img"),caption=$(largeimagecontainer).children("h3"),numThumbs=thumbs.size(),current=thumbs[index];function showImg(img){if(debug(selector+": img showImg() called for thumbnail <a> with href "+$(img).attr("href")),$(img).attr("href")!=$(large).attr("src")){"out-in"!=gallerySettings[id].fade&&"over"!=gallerySettings[id].fade||($(large).hide(),$(largeimagecontainer).addClass("loading")),$(large).attr("src",$(img).attr("href")).attr("title",$(img).attr("title")).attr("alt",$(img).attr("title"));var captionHTML=$.trim($(img).parent().parent().children("dd").html()),resize=null;$(caption).html(captionHTML),$(large).parent().attr("href",$(img).attr("href")),"object"==typeof shutterReloaded&&$(large).parent().click((function(){return shutterLinks.simpleviewer=null,shutterLinks.simpleviewer={link:$(img).attr("href"),num:-1,set:0,title:captionHTML},shutterReloaded.make("simpleviewer"),$(window).attr("onresize",""),!1})),$(thumbs).removeClass("current"),$(img).addClass("current"),updateNavigation()}}function setBgImage(){"over"==gallerySettings[id].fade&&(debug(selector+": set background image to "+$(large).attr("src")),$(largeimagecontainer).css("background-image","url("+$(large).attr("src")+")"))}function checkKey(e){switch(e.keyCode){case 40:case 39:showNext();break;case 38:case 37:showPrevious()}}function showNext(){hasNext()&&(index++,showImg(thumbs[index]))}function showPrevious(){hasPrevious()&&(index--,showImg(thumbs[index]))}function hasNext(){return index<numThumbs-1}function hasPrevious(){return index>0}function updateNavigation(){hasPrevious()?($(selector+" .simplegalleryprev").addClass("enabled"),$(selector+" .simplegalleryprev").removeClass("disabled")):($(selector+" .simplegalleryprev").addClass("disabled"),$(selector+" .simplegalleryprev").removeClass("enabled")),hasNext()?($(selector+" .simplegallerynext").addClass("enabled"),$(selector+" .simplegallerynext").removeClass("disabled")):($(selector+" .simplegallerynext").addClass("disabled"),$(selector+" .simplegallerynext").removeClass("enabled")),$(selector+" .simplegalleryimagenumber").html(index+1)}if($(thumbs).attr("class",""),debug(selector+": thumbnail classes removed"),$(largeimagecontainer).children("a").attr("class",""),debug(selector+": large image classes removed: "+$(largeimagecontainer).children("a").attr("class")),$(thumbs).click((function(){for(i=0;i<numThumbs;i++)if(thumbs[i]==this){index=i;break}return showImg($(this)),!1})),$(large).load((function(){debug(selector+": img load() called for img "+$(this).attr("src"));var resize=!1;if($.browser.msie&&0==$.browser.version.indexOf("6.0")&&(resize=!0),resize){$(large).width(""),$(large).height("");var src=$(large).attr("src"),constraint="width",size=parseInt($(large).width()),cssMaxSize=$(large).css("max-"+constraint),cssRatio=parseInt(cssMaxSize)/parseInt($(large).css("max-height")),imageRatio=size/parseInt($(large).height());debug(selector+": "+src+": css ratio "+cssRatio+" img ratio "+imageRatio),parseInt($(large).height())>size&&(constraint="height",size=parseInt($(large).height()),cssMaxSize=$(large).css("max-height")),debug(selector+": "+src+": constraint is "+constraint),""!=cssMaxSize&&cssMaxSize.indexOf("px")>-1&&(size>(cssMaxSize=parseInt(cssMaxSize))?("height"==constraint?$(large).height(cssMaxSize):"width"==constraint&&$(large).width(cssMaxSize),debug(selector+": "+src+": "+constraint+" of changed from "+size+" down to "+cssMaxSize)):debug(selector+": "+src+": no need to shrink. "+constraint+" already "+size))}debug(selector+": image W x H:  "+$(large).width()+" x "+$(large).height()),"out-in"!=gallerySettings[id].fade&&"over"!=gallerySettings[id].fade||$(large).fadeIn(gallerySettings[id].fadespeed,(function(){$(largeimagecontainer).removeClass("loading"),setBgImage()}))})),showImg(thumbs[0]),$(selector+" .simplegallerynavbar").append("<ul>"),$(selector+" .simplegallerynavbar ul").append('<li class="simplegalleryprev disabled"><a href="javascript:void();" title="Previous"><span>&larr;</span></a></li>').append('<li class="simplegalleryimagenumbers"><span class="simplegalleryimagenumber">1</span> / <span class="simplegallerytotalimages">'+numThumbs+"</span></li>").append('<li class="simplegallerynext enabled"><a href="javascript:void();" title="Next"><span>&rarr;</span></a></li>').append("</ul>"),$(selector+" .simplegalleryprev").click((function(){return!$(this).hasClass("disabled")&&(showPrevious(),!1)})),$(selector+" .simplegallerynext").click((function(){return!$(this).hasClass("disabled")&&(showNext(),!1)})),$.browser.mozilla?$(document).keypress(checkKey):$(document).keydown(checkKey),1==gallerySettings[id].thumbnailscroll){var $item=$(thumbnailcontainer).find(".gallery dl.gallery-item"),scrollingIndex=0,displayWidth=$(thumbnailcontainer).find("div.gallerywrapper").width();totalWidth=0,scrollingIndexEnd=0,$item.each((function(){totalWidth+=parseInt($(this).outerWidth(!0))})),scrollingIndexEnd=totalWidth/displayWidth-1,scrollingIndexEnd<0&&(scrollingIndexEnd=0),$(thumbnailcontainer).find("div.gallerywrapper div.gallery").css("min-width",totalWidth+"px"),$(thumbnailcontainer).find(".thumbnailscroll").height($(thumbnailcontainer).height()),scrollingIndexEnd>0&&($(thumbnailcontainer).find(".thumbnailscroll.thumbnailscroll-prev").click((function(){scrollingIndex>0&&(scrollingIndex--,simplegallery_thumbnail_navigation_arrows(thumbnailcontainer,scrollingIndex,scrollingIndexEnd),$item.animate({left:"+="+displayWidth+"px"},"slow"))})),$(thumbnailcontainer).find(".thumbnailscroll.thumbnailscroll-next").click((function(){scrollingIndex<scrollingIndexEnd&&(scrollingIndex++,simplegallery_thumbnail_navigation_arrows(thumbnailcontainer,scrollingIndex,scrollingIndexEnd),$item.animate({left:"-="+displayWidth+"px"},"slow"))}))),simplegallery_thumbnail_navigation_arrows(thumbnailcontainer,scrollingIndex,scrollingIndexEnd)}}function simplegallery_thumbnail_navigation_arrows(container,idx,endIdx){0==idx&&endIdx>0?($(container).find(".thumbnailscroll.thumbnailscroll-prev").css("visibility","hidden"),$(container).find(".thumbnailscroll.thumbnailscroll-next").css("visibility","visible")):0==idx&&0==endIdx?($(container).find(".thumbnailscroll.thumbnailscroll-prev").css("visibility","hidden"),$(container).find(".thumbnailscroll.thumbnailscroll-next").css("visibility","hidden")):idx>0&&idx<endIdx?($(container).find(".thumbnailscroll.thumbnailscroll-prev").css("visibility","visible"),$(container).find(".thumbnailscroll.thumbnailscroll-next").css("visibility","visible")):idx>0&&idx>=endIdx&&($(container).find(".thumbnailscroll.thumbnailscroll-prev").css("visibility","visible"),$(container).find(".thumbnailscroll.thumbnailscroll-next").css("visibility","hidden"))}}));